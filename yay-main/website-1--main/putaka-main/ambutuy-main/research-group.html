<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Research Groups Analytics</title>
<style>
* { box-sizing: border-box; }
body { margin:0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f5f7fa; }
.header { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; padding:20px 40px; display:flex; justify-content:space-between; align-items:center; }
.back-btn { background: rgba(255,255,255,0.2); color:white; border:1px solid white; padding:8px 16px; border-radius:6px; cursor:pointer; }
.container { max-width:1400px; margin:auto; padding:40px 20px; }
h2 { margin-bottom:10px; color:#333; }
.groups-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(300px,1fr)); gap:20px; margin-top:30px; }
.group-card { background:white; padding:22px; border-radius:14px; box-shadow:0 6px 18px rgba(0,0,0,0.1); border-left:6px solid #667eea; }
.group-card h3 { margin:0 0 12px; color:#667eea; }
.group-card .section-name { font-size:12px; color:#555; margin-bottom:8px; font-weight:600; }
.metric { font-size:14px; margin-bottom:8px; color:#444; }
.metric strong { color:#000; }
.empty { text-align:center; color:#999; margin-top:60px; font-size:16px; }
</style>
</head>
<body>

<div class="header">
    <h1>üìò Research Groups Analytics</h1>
    <button class="back-btn" onclick="goBack()">‚Üê Back to Sections</button>
</div>

<div class="container">
    <h2 id="sectionLabel"></h2>
    <div class="groups-grid" id="groupsGrid"></div>
    <div class="empty" id="emptyState">No groups found.</div>
</div>

<script>
function goBack() {
    window.location.href = 'research-analytics.html';
}

// Get current section from localStorage
const sectionName = localStorage.getItem('currentSection');
document.getElementById('sectionLabel').textContent = `Section: ${sectionName || 'Unknown'}`;

function loadGroups() {
    const grid = document.getElementById('groupsGrid');
    const empty = document.getElementById('emptyState');
    grid.innerHTML = '';

    const allSectionGroups = JSON.parse(localStorage.getItem('allSectionGroups')) || {};
    const groups = allSectionGroups[sectionName] || [];

    if(groups.length === 0){
        empty.style.display = 'block';
        return;
    }
    empty.style.display = 'none';

    groups.forEach(group => {
        const totalChapters = group.chapters?.length || 0;
        const completed = group.chapters?.filter(c=>c.submitted).length || 0;
        const complianceRate = totalChapters === 0 ? 0 : Math.round((completed/totalChapters)*100);
        const delays = group.chapters?.filter(c=>c.submitted && c.delayDays>0).map(c=>c.delayDays) || [];
        const avgDelay = delays.length === 0 ? 0 : (delays.reduce((a,b)=>a+b,0)/delays.length).toFixed(1);

        const card = document.createElement('div');
        card.className = 'group-card';
        card.innerHTML = `
            <div class="section-name">Section: ${sectionName}</div>
            <h3>${group.groupName || 'Unnamed Group'}</h3>
            <div class="metric">üìò Completed Chapters: <strong>${completed} / ${totalChapters}</strong></div>
            <div class="metric">üìä Submission Compliance: <strong>${complianceRate}%</strong></div>
            <div class="metric">‚è± Average Delay: <strong>${avgDelay} days</strong></div>
        `;
        grid.appendChild(card);
    });
}

loadGroups();
</script>

</body>
</html>